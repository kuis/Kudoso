.row
  .col-md-4.col-md-offset-1
    %h3 Assign Tasks:
.row
  .col-md-8.col-md-offset-1
    Tasks are parent directed daily activities that you assign to your kids.  We have currated this simple list of
    age appropriate chores to get you started, you can assign them as Tasks to each child with a single click below.
    You can customize your assigned Tasks for each child after the setup wizard is complete.
- current_user.family.kids.each do |kid|
  - if (2..12).include?(kid.age)
    .row
      .col-md-11.col-md-offset-1
        %hr
    .row
      .col-md-3.col-md-offset-1
        = "#{kid.first_name} (age: #{kid.age})"
        %small
          Assigned tasks:
          %div{id: "child_#{kid.id}_tasks"}
            - kid.todos.each do |todo|
              #{todo.inspect}
      .col-md-4
        %table.table
          -  @todo_groups = TodoGroup.active.where('rec_min_age <= ? AND rec_max_age >= ?', kid.age, kid.age )
          - if @todo_groups.size > 0
            - @todo_groups.each do |todo_group|
              .panel.panel-default{ id: "child_#{kid.id}_group_#{todo_group.id}"}
                .panel-heading
                  #{todo_group.name} (Ages: #{todo_group.rec_min_age} - #{todo_group.rec_max_age})
                .panel-body
                  %ul
                    - todo_group.todo_templates.each do |todo_template|
                      %li #{todo_template.name}
                .panel-footer
                  %button.btn.btn-default{ onclick: "assign_group(#{todo_group.id}, #{kid.id});"}
                    Assign to #{kid.first_name}
:javascript
  function assign_group(groupId, kidId) {
    $("#child_" + kidId + "_group_" + groupId).slideUp();
    $.ajax({
      url: "/families/#{ current_user.family_id }/members/" + kidId + "/todo_groups/" + groupId + "/assign",
      dataType: 'json',
      method: 'POST',
      success: function(e) {
        console.log(e);
        var tasks =  $("#child_" + kidId + "_group_" + groupId).detach();
        tasks.appendTo($("#child_" + kidId + "_tasks"));
        $("#child_" + kidId + "_group_" + groupId + " .panel-footer").remove();
        tasks.slideDown();
      },
      error: function() {
        alert('error');
        $("#child_" + kidId + "_group_" + groupId).slideDown();
      }
    });
  }
  function save_info(args) {
    $.ajax({
      url: '/wizard',
      dataType: 'json',
      method: 'PUT',
      data: {
        step: 4
      },
      success: function() {
        args && args.success && args.success();
      },
      error: function(e) {
        alert("Sorry, there was an error saving your information.");
      }

    });

  }